# Development CORS Configuration
# This file provides permissive CORS for development environments
# Only use this in development/staging, never in production

# Check if this is a development request
map $http_x_dev_mode $is_dev_request {
    default 0;
    "true" 1;
    "1" 1;
}

# Development-friendly CORS headers
if ($is_dev_request = 1) {
    # Allow any origin for development
    add_header Access-Control-Allow-Origin $http_origin always;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH" always;
    add_header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With, X-CSRF-Token, Accept, Origin, X-Dev-Mode, X-MAC-Address" always;
    add_header Access-Control-Allow-Credentials "true" always;
    add_header Access-Control-Max-Age "86400" always;
    add_header Vary "Origin" always;
}

# Handle preflight requests for development
if ($request_method = 'OPTIONS' && $is_dev_request = 1) {
    add_header Access-Control-Allow-Origin $http_origin always;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH" always;
    add_header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With, X-CSRF-Token, Accept, Origin, X-Dev-Mode, X-MAC-Address" always;
    add_header Access-Control-Allow-Credentials "true" always;
    add_header Access-Control-Max-Age "86400" always;
    add_header Vary "Origin" always;
    add_header Content-Length 0;
    add_header Content-Type text/plain;
    return 204;
}
